<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÑ‡∏ü TTLight</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        background-color: #f4f4f9;
        margin: 0;
      }
      .container {
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        width: 100%;
        max-width: 400px;
        text-align: center;
      }
      h1 {
        color: #333;
        margin-bottom: 20px;
      }
      .input-group {
        margin-bottom: 20px;
        text-align: left;
      }
      .input-group label {
        display: block;
        margin-bottom: 5px;
        color: #555;
      }
      .input-group input {
        width: calc(100% - 20px);
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 16px;
      }
      .button-group {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        margin-bottom: 20px;
      }
      .control-button {
        padding: 20px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        color: #fff;
        font-weight: bold;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .control-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      }
      .green { background-color: #4CAF50; }
      .yellow { background-color: #FFC107; }
      .red { background-color: #F44336; }
      .purple { background-color: #9C27B0; }
      
      /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏õ‡∏¥‡∏î */
      .control-button.active {
        box-shadow: 0 0 15px 5px #ffeb3b;
        transform: scale(1.05);
      }

      .icon {
        font-size: 24px;
        margin-top: 5px;
      }

      .message-box {
        margin-top: 20px;
        padding: 10px;
        background-color: #e3f2fd;
        border: 1px solid #bbdefb;
        border-radius: 4px;
        font-size: 14px;
        color: #333;
        word-wrap: break-word;
        white-space: pre-wrap;
        text-align: left;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÑ‡∏ü TTLight</h1>

      <div class="input-group">
        <label for="macAddress">‡∏Å‡∏£‡∏≠‡∏Å Mac Address ‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏≤‡πÑ‡∏ü:</label>
        <input type="text" id="macAddress" name="macAddress" placeholder="‡πÄ‡∏ä‡πà‡∏ô: 01:23:45:67:89:AB">
      </div>

      <div class="button-group">
        <button class="control-button green" data-color="green" onclick="toggleLightStatus('green')">
          <span>‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î ‡πÑ‡∏ü‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß</span>
          <span id="green-icon" class="icon">‚ö™</span>
        </button>
        <button class="control-button yellow" data-color="yellow" onclick="toggleLightStatus('yellow')">
          <span>‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î ‡πÑ‡∏ü‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á</span>
          <span id="yellow-icon" class="icon">‚ö™</span>
        </button>
        <button class="control-button red" data-color="red" onclick="toggleLightStatus('red')">
          <span>‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î ‡πÑ‡∏ü‡πÅ‡∏î‡∏á</span>
          <span id="red-icon" class="icon">‚ö™</span>
        </button>
        <button class="control-button purple" data-color="purple" onclick="toggleLightStatus('purple')">
          <span>‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î ‡πÑ‡∏ü‡∏°‡πà‡∏ß‡∏á</span>
          <span id="purple-icon" class="icon">‚ö™</span>
        </button>
      </div>

      <button id="sendPostBtn" class="control-button" style="background-color: #1976D2; width: 100%;" onclick="sendData()">
        ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á POST
      </button>

      <div class="message-box" id="response">
        ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á...
      </div>
    </div>

    <script>
      let currentStatus = {
        red: 'OFF',
        yellow: 'OFF',
        green: 'OFF',
        purple: 'OFF'
      };

      function toggleLightStatus(color) {
        currentStatus[color] = currentStatus[color] === 'ON' ? 'OFF' : 'ON';
        updateUI();
      }

      function updateUI() {
        const colors = ['red', 'yellow', 'green', 'purple'];
        colors.forEach(color => {
          const button = document.querySelector(`.control-button.${color}`);
          const icon = document.getElementById(`${color}-icon`);
          
          if (currentStatus[color] === 'ON') {
            button.classList.add('active');
            icon.textContent = 'üü¢'; // Green ON icon
          } else {
            button.classList.remove('active');
            icon.textContent = '‚ö™'; // White OFF icon
          }
        });
      }

      function sendData() {
        const macAddress = document.getElementById('macAddress').value;
        if (!macAddress) {
          document.getElementById('response').innerText = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Mac Address!';
          return;
        }

        const payload = [
          {
            "factory_id": "TTT",
            "machine_id": macAddress,
            "cmd": [
              {
                "type": "change_light",
                "status": [currentStatus]
              }
            ]
          }
        ];

        document.getElementById('response').innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á... ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà';

        google.script.run
          .withSuccessHandler(onSuccess)
          .withFailureHandler(onFailure)
          .sendPostToApi(payload);
      }

      function onSuccess(response) {
        if (response.success) {
          document.getElementById('response').innerText = "‚úÖ ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n\n‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÑ‡∏õ:\n" + JSON.stringify(response.response, null, 2);
        } else {
          document.getElementById('response').innerText = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á\n\n‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:\n" + JSON.stringify(response.error, null, 2);
        }
      }

      function onFailure(error) {
        document.getElementById('response').innerText = "‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏Ñ‡∏≤‡∏î‡∏Ñ‡∏¥‡∏î: " + error.message;
      }
    </script>
  </body>
</html>
